<!DOCTYPE html>
<html>
<head>
  <title>scrz</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:100,300,400,600,700&amp;subset=latin,latin-ext">
</head>
<body class="inner">
  <header>
    <section id="logo">
      <span class="scrz">scrz<em>v0.0.1</em></span>
    </section>
    <nav class="clearfix">
      <a href="/">Home</a>
      <a href="/guide.html" class="active">Guide</a>
      <a href="/screenshots.html">Screenshots</a>
      <a href="/contact.html">Contact</a>
      <a href="/faq.html">FAQ</a>
    </nav>
  </header>
  <section id="content">
    <div id="guide">
      <h1>Overview</h1>
      <p>
      scrz comes in two parts. One is a the management server where you manage
      your deployment configuration, and the other is a process supervisor
      which runs and supervises your apps.
      </p>

      <h1>Installation</h1>
      <h2>Management Server</h2>
      <p><a href="https://github.com/wereHamster/scrz-http-authority">GitHub repository</a></p>
      <p>
      The management server is a Ruby on Rails app. It requires very little
      configuration, but depends on S3 and GitHub for storage and authentication.
      </p>
      <p>
      These are the environment variables you need to set:
      <ul>
        <li>
          <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code><br>
          AWS credentials which have read/write access to the S3 bucket.
        </li>
        <li>
          <code>BUCKET_NAME</code><br>
          The S3 bucket where to store the slugs.
        </li>
        <li><code>SECRET_TOKEN</code><br>
          The application secret token (Application.config.secret_token). An alphanumeric string of sufficient length.
        </li>
        <li><code>GITHUB_CLIENT_ID</code> and <code>GITHUB_CLIENT_SECRET</code><br>
          Client ID and secret of your registered GitHub application.
        </li>
        <li><code>GITHUB_ORG</code><br>
          The name of the GitHub organization whose members shall have access to the web interface.
        </li>
      </ul>
      </p>
      <p>
        If you don't want to bother setting up your own server, we highly recommend
        you to deploy the management server to Heroku.
      </p>

      <h2>Supervisor</h2>
      <p><a href="https://github.com/wereHamster/scrz">GitHub repository</a></p>
      <p>
        The supervisor runs on your servers, periodically contacts the management
        server to fetch the configuration and runs selected services.
      </p>
      <p>
        It is a Haskell app. Next to the Haskell runtime
        you need libcurl-dev (required by the curl cabal package).
        If you have all the dependencies installed, download the supervisor source
        and run <code>cabal configure</code> followed by <code>cabal build</code>.
        This binary will be available at <code>dist/build/scrz/scrz</code>.
        You can copy it wherever you want.
      </p>
      <p>
        To start the supervisor, run the binary and give it as first and only
        argument the url to your supervisor, eg.
      </p>
      <pre><code>dist/build/scrz/scrz http://scrz.example.tld</code></pre>
      <p>
        Note that the supervisor sends the hostname to the management server. So
        make sure hostnames are meaningful and unique across your servers.
      </p>

      <h1>Usage</h1>
      <p>
        In this section you'll learn how to configure and use scrz.
        I assume that both the management server and supervisor are running. If not,       please read the installation guide.
      </p>
      <p>
        The first thing you have to do is create a new project.
        A project provides one or more services. These services share the same
        precompiled package (slug), but each uses a different command and
        environment. As a general rule, each git repository you have should be
        its own project in scrz.
      </p>
      <p>
        Once you have a project, you define one or more services. If you have a
        web application, then one service would be the http server. If your app
        needs background workers, then create one service for that.
      </p>

      <h2>Slugs</h2>
      <p>
        The precompiled package, or slug as Heroku calls it, it a SquashFS image
        which contains the project in a compiled form, so that the configured
        services can run off of it.
      </p>
      <p>
        The steps required to compiled your app into a slug depend on the
        programing language you use, the framework etc. Scrz does not include
        any support for creating these slugs. But usually it's reasonably easy
        to write a short shell script which creates one. Here is a simple
        example for a Ruby on Rails project:
      </p>
      <pre><code>#!/bin/se
set -e

bundle --deployment --without development test
RAILS_ENV=production bundle exec rake assets:precompile

mksquashfs "." "../app.slug" -all-root -comp xz</code></pre>
      <p>
        Once you have the slug, you need to upload it to the management server.
        It will store it on S3 and make available to any supervisors which need
        to run services provided by this slug. Each project has a token which
        is required for the upload. Keep this token secret. The name of slugs
        within each project must be unique. We suggest that you put the project
        version into the name. This helps you recognizing the slugs later.
      </p>
      <pre><code>curl -H 'Authorization: Token the-token' \
    -F name=a-unique-name-v42 \
    -F file=@path/to/app.slug \
    http://scrz.example.tld/projects/the-project/slug</code></pre>

      <h2>Services and Revisions</h2>
      <p>
        Configuration of services is stored in Revisions. Each time you change
        the configuration, a new revision is created. That way you can always
        go back if you make a mistake or deploy a buggy version.
      </p>
      <p>
        Each Revision specifies which slug to use, the command to execute and
        the environment. In a typical Ruby on Rails app, the command to execute
        the web server would be <code>bundle exec rails server</code>. In the
        environment you'd set <code>RAILS_ENV</code> to <code>production</code>
        and include other environment variables necessary in your app.
      </p>

      <h2>Deployments</h2>
      <p>
        When a supervisor contacts the management server, it sends along its
        hostname. The supervisor therefore has a list of all servers which
        are ready to run your services.
        All you have to do is tell scrz on which servers the service should
        be deployed.
      </p>

      <h1>Notes and Warnings</h1>
      <p>
        I'm glad you found scrz interesting enough to read to the end of this
        guide.
      </p>
      <p>
        Scrz is being used in production at a smaller site. But there probably
        are lots of bugs. Some parts are also incomplete, as I haven't had
        the time to implement all that I wanted.
      </p>
      <p>
        If you find the project interesting and want to contribute,
        <a href="/contact.html">contact</a> me or fork the repos (<a href="https://github.com/wereHamster/scrz-http-authority">management server</a>,
        <a href="https://github.com/wereHamster/scrz">supervisor</a>) and send
        me pull requests.
      </p>
    </div>
  </section>
</body>
</html>
